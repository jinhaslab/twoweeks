<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 17 Repeated analysis | DsPubs with R tutor book</title>
  <meta name="description" content="Chapter 17 Repeated analysis | DsPubs with R tutor book" />
  <meta name="generator" content="bookdown 0.29 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 17 Repeated analysis | DsPubs with R tutor book" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 17 Repeated analysis | DsPubs with R tutor book" />
  
  
  

<meta name="author" content="jinha" />


<meta name="date" content="2022-11-21" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="date-and-time-series.html"/>
<link rel="next" href="r-markdown.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://dspubs.org/webapps">DsPubs</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="lets-start-with-r-and-r-studio.html"><a href="lets-start-with-r-and-r-studio.html"><i class="fa fa-check"></i><b>2</b> Let’s Start with R and R studio</a>
<ul>
<li class="chapter" data-level="2.1" data-path="lets-start-with-r-and-r-studio.html"><a href="lets-start-with-r-and-r-studio.html#rstudio-cloud-and-colab"><i class="fa fa-check"></i><b>2.1</b> Rstudio Cloud, and colab</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="lets-start-with-r-and-r-studio.html"><a href="lets-start-with-r-and-r-studio.html#rstudio-cloud"><i class="fa fa-check"></i><b>2.1.1</b> Rstudio Cloud</a></li>
<li class="chapter" data-level="2.1.2" data-path="lets-start-with-r-and-r-studio.html"><a href="lets-start-with-r-and-r-studio.html#colab"><i class="fa fa-check"></i><b>2.1.2</b> Colab</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="lets-start-with-r-and-r-studio.html"><a href="lets-start-with-r-and-r-studio.html#r-and-r-studio-on-window-system"><i class="fa fa-check"></i><b>2.2</b> R and R studio on Window system</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="lets-start-with-r-and-r-studio.html"><a href="lets-start-with-r-and-r-studio.html#r-studio-install"><i class="fa fa-check"></i><b>2.2.1</b> R studio install</a></li>
<li class="chapter" data-level="2.2.2" data-path="lets-start-with-r-and-r-studio.html"><a href="lets-start-with-r-and-r-studio.html#r-studio-project"><i class="fa fa-check"></i><b>2.2.2</b> R studio project</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="lets-start-with-r-and-r-studio.html"><a href="lets-start-with-r-and-r-studio.html#r-and-r-studio-on-ubuntus"><i class="fa fa-check"></i><b>2.3</b> R and R studio on Ubuntus</a></li>
</ul></li>
<li class="part"><span><b>I R</b></span></li>
<li class="chapter" data-level="3" data-path="r-basics.html"><a href="r-basics.html"><i class="fa fa-check"></i><b>3</b> R basics</a>
<ul>
<li class="chapter" data-level="3.1" data-path="r-basics.html"><a href="r-basics.html#vector-matirx-list"><i class="fa fa-check"></i><b>3.1</b> vector matirx list</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="r-basics.html"><a href="r-basics.html#오브젝트-objects"><i class="fa fa-check"></i><b>3.1.1</b> 오브젝트 (objects)</a></li>
<li class="chapter" data-level="3.1.2" data-path="r-basics.html"><a href="r-basics.html#백터-vectors-팩터-factors"><i class="fa fa-check"></i><b>3.1.2</b> 백터 (Vectors), 팩터 (factors)</a></li>
<li class="chapter" data-level="3.1.3" data-path="r-basics.html"><a href="r-basics.html#매트릭스-matrix-데이터프래임-data-frame-리스트-list"><i class="fa fa-check"></i><b>3.1.3</b> 매트릭스 (Matrix), 데이터프래임 (data frame), 리스트 (list)</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="r-basics.html"><a href="r-basics.html#데이터-생성-저장"><i class="fa fa-check"></i><b>3.2</b> 데이터 생성 저장</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="r-basics.html"><a href="r-basics.html#built-in-data-sets"><i class="fa fa-check"></i><b>3.2.1</b> built-in data sets</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="r-program-basic.html"><a href="r-program-basic.html"><i class="fa fa-check"></i><b>4</b> R program basic</a>
<ul>
<li class="chapter" data-level="4.1" data-path="r-program-basic.html"><a href="r-program-basic.html#기초-연산"><i class="fa fa-check"></i><b>4.1</b> 기초 연산</a></li>
<li class="chapter" data-level="4.2" data-path="r-program-basic.html"><a href="r-program-basic.html#조건부-연산"><i class="fa fa-check"></i><b>4.2</b> 조건부 연산</a></li>
<li class="chapter" data-level="4.3" data-path="r-program-basic.html"><a href="r-program-basic.html#함수-만들기"><i class="fa fa-check"></i><b>4.3</b> 함수 만들기</a></li>
<li class="chapter" data-level="4.4" data-path="r-program-basic.html"><a href="r-program-basic.html#반복문-vectorization-functionals"><i class="fa fa-check"></i><b>4.4</b> 반복문, vectorization, functionals</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="r-program-basic.html"><a href="r-program-basic.html#for-loop"><i class="fa fa-check"></i><b>4.4.1</b> for loop</a></li>
<li class="chapter" data-level="4.4.2" data-path="r-program-basic.html"><a href="r-program-basic.html#vectorization-과-apply-구문"><i class="fa fa-check"></i><b>4.4.2</b> vectorization 과 apply 구문</a></li>
<li class="chapter" data-level="4.4.3" data-path="r-program-basic.html"><a href="r-program-basic.html#home-work-and-summary-function"><i class="fa fa-check"></i><b>4.4.3</b> home work and summary function</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="data-manipulation.html"><a href="data-manipulation.html"><i class="fa fa-check"></i><b>5</b> Data Manipulation</a>
<ul>
<li class="chapter" data-level="5.1" data-path="data-manipulation.html"><a href="data-manipulation.html#dplyr-tidyverse"><i class="fa fa-check"></i><b>5.1</b> dplyr (tidyverse)</a></li>
<li class="chapter" data-level="5.2" data-path="data-manipulation.html"><a href="data-manipulation.html#실습-데이터-준비"><i class="fa fa-check"></i><b>5.2</b> 실습 데이터 준비</a></li>
<li class="chapter" data-level="5.3" data-path="data-manipulation.html"><a href="data-manipulation.html#select"><i class="fa fa-check"></i><b>5.3</b> select</a></li>
<li class="chapter" data-level="5.4" data-path="data-manipulation.html"><a href="data-manipulation.html#filter"><i class="fa fa-check"></i><b>5.4</b> filter</a></li>
<li class="chapter" data-level="5.5" data-path="data-manipulation.html"><a href="data-manipulation.html#arrange"><i class="fa fa-check"></i><b>5.5</b> arrange</a></li>
<li class="chapter" data-level="5.6" data-path="data-manipulation.html"><a href="data-manipulation.html#mutate"><i class="fa fa-check"></i><b>5.6</b> mutate</a></li>
<li class="chapter" data-level="5.7" data-path="data-manipulation.html"><a href="data-manipulation.html#group_by"><i class="fa fa-check"></i><b>5.7</b> group_by</a></li>
<li class="chapter" data-level="5.8" data-path="data-manipulation.html"><a href="data-manipulation.html#merge-join"><i class="fa fa-check"></i><b>5.8</b> merge, join</a></li>
</ul></li>
<li class="part"><span><b>II Visualization</b></span></li>
<li class="chapter" data-level="6" data-path="tables-for-public-health-1.html"><a href="tables-for-public-health-1.html"><i class="fa fa-check"></i><b>6</b> Tables for public health 1</a>
<ul>
<li class="chapter" data-level="6.1" data-path="tables-for-public-health-1.html"><a href="tables-for-public-health-1.html#데이터표-준비"><i class="fa fa-check"></i><b>6.1</b> 데이터표 준비</a></li>
<li class="chapter" data-level="6.2" data-path="tables-for-public-health-1.html"><a href="tables-for-public-health-1.html#central-tendency-mean-median-mode"><i class="fa fa-check"></i><b>6.2</b> Central Tendency (mean, median, mode)</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="tables-for-public-health-1.html"><a href="tables-for-public-health-1.html#하나씩-반복"><i class="fa fa-check"></i><b>6.2.1</b> 하나씩 반복</a></li>
<li class="chapter" data-level="6.2.2" data-path="tables-for-public-health-1.html"><a href="tables-for-public-health-1.html#group_by-summary-and-table-1"><i class="fa fa-check"></i><b>6.2.2</b> Group_by summary and Table 1</a></li>
<li class="chapter" data-level="6.2.3" data-path="tables-for-public-health-1.html"><a href="tables-for-public-health-1.html#long-file-and-table-1"><i class="fa fa-check"></i><b>6.2.3</b> Long File and Table 1</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="tables-for-public-health-1.html"><a href="tables-for-public-health-1.html#count-and-distribution"><i class="fa fa-check"></i><b>6.3</b> Count and Distribution</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="tables-for-public-health-1.html"><a href="tables-for-public-health-1.html#하나씩-반복-1"><i class="fa fa-check"></i><b>6.3.1</b> 하나씩 반복</a></li>
<li class="chapter" data-level="6.3.2" data-path="tables-for-public-health-1.html"><a href="tables-for-public-health-1.html#group_by-summary-and-table-1-1"><i class="fa fa-check"></i><b>6.3.2</b> Group_by summary and Table 1</a></li>
<li class="chapter" data-level="6.3.3" data-path="tables-for-public-health-1.html"><a href="tables-for-public-health-1.html#long-file-and-table-1-1"><i class="fa fa-check"></i><b>6.3.3</b> Long File and Table 1</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="tables-for-public-health-1.html"><a href="tables-for-public-health-1.html#정리-1"><i class="fa fa-check"></i><b>6.4</b> 정리 1</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="tables-for-public-health-1.html"><a href="tables-for-public-health-1.html#과제"><i class="fa fa-check"></i><b>6.4.1</b> 과제</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="Tables2.html"><a href="Tables2.html"><i class="fa fa-check"></i><b>7</b> Tables for public health 2</a>
<ul>
<li class="chapter" data-level="7.1" data-path="Tables2.html"><a href="Tables2.html#데이터-준비"><i class="fa fa-check"></i><b>7.1</b> 데이터 준비</a></li>
<li class="chapter" data-level="7.2" data-path="Tables2.html"><a href="Tables2.html#분석-주제-선정"><i class="fa fa-check"></i><b>7.2</b> 분석 주제 선정</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="Tables2.html"><a href="Tables2.html#근로환경조사와-recode-선택사항"><i class="fa fa-check"></i><b>7.2.1</b> 근로환경조사와 recode (선택사항)</a></li>
<li class="chapter" data-level="7.2.2" data-path="Tables2.html"><a href="Tables2.html#근로환경조사-기본-변수-생성"><i class="fa fa-check"></i><b>7.2.2</b> 근로환경조사 기본 변수 생성</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="Tables2.html"><a href="Tables2.html#근로환경조사-table-1-만들기"><i class="fa fa-check"></i><b>7.3</b> 근로환경조사 Table 1 만들기</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="Tables2.html"><a href="Tables2.html#변수-값-요약하기"><i class="fa fa-check"></i><b>7.3.1</b> 변수 값 요약하기</a></li>
<li class="chapter" data-level="7.3.2" data-path="Tables2.html"><a href="Tables2.html#p-value-구하기."><i class="fa fa-check"></i><b>7.3.2</b> P value 구하기.</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="Tables2.html"><a href="Tables2.html#table-1-정리하기"><i class="fa fa-check"></i><b>7.4</b> Table 1 정리하기</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="Tables2.html"><a href="Tables2.html#htmltable-visulaization"><i class="fa fa-check"></i><b>7.4.1</b> htmlTable visulaization</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="Tables2.html"><a href="Tables2.html#kwcsfunction"><i class="fa fa-check"></i><b>7.5</b> 함수만들기</a></li>
<li class="chapter" data-level="7.6" data-path="Tables2.html"><a href="Tables2.html#quiz"><i class="fa fa-check"></i><b>7.6</b> Quiz</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="Tables2.html"><a href="Tables2.html#quiz1"><i class="fa fa-check"></i><b>7.6.1</b> Quiz1</a></li>
<li class="chapter" data-level="7.6.2" data-path="Tables2.html"><a href="Tables2.html#quiz-2"><i class="fa fa-check"></i><b>7.6.2</b> Quiz 2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="tables-for-public-health-3.html"><a href="tables-for-public-health-3.html"><i class="fa fa-check"></i><b>8</b> Tables for public health 3</a>
<ul>
<li class="chapter" data-level="8.1" data-path="tables-for-public-health-3.html"><a href="tables-for-public-health-3.html#데이터-준비-1"><i class="fa fa-check"></i><b>8.1</b> 데이터 준비</a></li>
<li class="chapter" data-level="8.2" data-path="tables-for-public-health-3.html"><a href="tables-for-public-health-3.html#분석-주제-선정-1"><i class="fa fa-check"></i><b>8.2</b> 분석 주제 선정</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="tables-for-public-health-3.html"><a href="tables-for-public-health-3.html#근로환경조사-기본-변수-생성-선택"><i class="fa fa-check"></i><b>8.2.1</b> 근로환경조사 기본 변수 생성 (선택)</a></li>
<li class="chapter" data-level="8.2.2" data-path="tables-for-public-health-3.html"><a href="tables-for-public-health-3.html#함수를-source-file-로-저장하기"><i class="fa fa-check"></i><b>8.2.2</b> 함수를 source file 로 저장하기</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="tables-for-public-health-3.html"><a href="tables-for-public-health-3.html#logistic-regression-table"><i class="fa fa-check"></i><b>8.3</b> Logistic Regression Table</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="tables-for-public-health-3.html"><a href="tables-for-public-health-3.html#로지스틱회귀분석-표-함수-1"><i class="fa fa-check"></i><b>8.3.1</b> 로지스틱회귀분석 표 함수 1</a></li>
<li class="chapter" data-level="8.3.2" data-path="tables-for-public-health-3.html"><a href="tables-for-public-health-3.html#로지스틱-회귀분석-표-2"><i class="fa fa-check"></i><b>8.3.2</b> 로지스틱 회귀분석 표 2</a></li>
<li class="chapter" data-level="8.3.3" data-path="tables-for-public-health-3.html"><a href="tables-for-public-health-3.html#로지스틱-회귀분석-3"><i class="fa fa-check"></i><b>8.3.3</b> 로지스틱 회귀분석 3</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="tables-for-public-health-summary.html"><a href="tables-for-public-health-summary.html"><i class="fa fa-check"></i><b>9</b> Tables for public health summary</a>
<ul>
<li class="chapter" data-level="9.1" data-path="tables-for-public-health-summary.html"><a href="tables-for-public-health-summary.html#install-package-from-github"><i class="fa fa-check"></i><b>9.1</b> install package from github</a></li>
<li class="chapter" data-level="9.2" data-path="tables-for-public-health-summary.html"><a href="tables-for-public-health-summary.html#data-import-and-manipulation"><i class="fa fa-check"></i><b>9.2</b> data import and manipulation</a></li>
<li class="chapter" data-level="9.3" data-path="tables-for-public-health-summary.html"><a href="tables-for-public-health-summary.html#select-variables-and-table-1"><i class="fa fa-check"></i><b>9.3</b> select variables, and table 1</a></li>
<li class="chapter" data-level="9.4" data-path="tables-for-public-health-summary.html"><a href="tables-for-public-health-summary.html#logistic-regression-model-and-table-3"><i class="fa fa-check"></i><b>9.4</b> logistic regression model and table 3</a></li>
<li class="chapter" data-level="9.5" data-path="tables-for-public-health-summary.html"><a href="tables-for-public-health-summary.html#quiz-1"><i class="fa fa-check"></i><b>9.5</b> Quiz</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="tables-for-public-health-summary.html"><a href="tables-for-public-health-summary.html#install-and-load-library-tabf"><i class="fa fa-check"></i><b>9.5.1</b> install and load library tabf</a></li>
<li class="chapter" data-level="9.5.2" data-path="tables-for-public-health-summary.html"><a href="tables-for-public-health-summary.html#data-manipulation-1"><i class="fa fa-check"></i><b>9.5.2</b> data manipulation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="basic-plot-with-r.html"><a href="basic-plot-with-r.html"><i class="fa fa-check"></i><b>10</b> Basic plot with R</a>
<ul>
<li class="chapter" data-level="10.1" data-path="basic-plot-with-r.html"><a href="basic-plot-with-r.html#ggplot-basic"><i class="fa fa-check"></i><b>10.1</b> ggplot basic</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="basic-plot-with-r.html"><a href="basic-plot-with-r.html#axis"><i class="fa fa-check"></i><b>10.1.1</b> axis</a></li>
<li class="chapter" data-level="10.1.2" data-path="basic-plot-with-r.html"><a href="basic-plot-with-r.html#layer-geom_x"><i class="fa fa-check"></i><b>10.1.2</b> layer, geom_x()</a></li>
<li class="chapter" data-level="10.1.3" data-path="basic-plot-with-r.html"><a href="basic-plot-with-r.html#geom_point"><i class="fa fa-check"></i><b>10.1.3</b> geom_point()</a></li>
<li class="chapter" data-level="10.1.4" data-path="basic-plot-with-r.html"><a href="basic-plot-with-r.html#geom_smooth"><i class="fa fa-check"></i><b>10.1.4</b> geom_smooth()</a></li>
<li class="chapter" data-level="10.1.5" data-path="basic-plot-with-r.html"><a href="basic-plot-with-r.html#faceting"><i class="fa fa-check"></i><b>10.1.5</b> faceting</a></li>
<li class="chapter" data-level="10.1.6" data-path="basic-plot-with-r.html"><a href="basic-plot-with-r.html#geom_bar"><i class="fa fa-check"></i><b>10.1.6</b> geom_bar()</a></li>
<li class="chapter" data-level="10.1.7" data-path="basic-plot-with-r.html"><a href="basic-plot-with-r.html#geom_density-geom_histogram"><i class="fa fa-check"></i><b>10.1.7</b> geom_density() , geom_histogram()</a></li>
<li class="chapter" data-level="10.1.8" data-path="basic-plot-with-r.html"><a href="basic-plot-with-r.html#geom_boxplot"><i class="fa fa-check"></i><b>10.1.8</b> geom_boxplot()</a></li>
<li class="chapter" data-level="10.1.9" data-path="basic-plot-with-r.html"><a href="basic-plot-with-r.html#d-plot"><i class="fa fa-check"></i><b>10.1.9</b> 3d plot</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="basic-plot-with-r.html"><a href="basic-plot-with-r.html#visualzation-example-1"><i class="fa fa-check"></i><b>10.2</b> Visualzation example 1</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="basic-plot-with-r.html"><a href="basic-plot-with-r.html#simple-machine-learning-decision-tree"><i class="fa fa-check"></i><b>10.2.1</b> simple machine learning decision tree</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="basic-plot-with-r.html"><a href="basic-plot-with-r.html#summary"><i class="fa fa-check"></i><b>10.3</b> summary</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="statistical-plot-with-ggplot2.html"><a href="statistical-plot-with-ggplot2.html"><i class="fa fa-check"></i><b>11</b> Statistical Plot with ggplot2</a>
<ul>
<li class="chapter" data-level="11.1" data-path="statistical-plot-with-ggplot2.html"><a href="statistical-plot-with-ggplot2.html#prerequisite"><i class="fa fa-check"></i><b>11.1</b> Prerequisite</a></li>
<li class="chapter" data-level="11.2" data-path="statistical-plot-with-ggplot2.html"><a href="statistical-plot-with-ggplot2.html#t-test-and-chisq-test-visualization"><i class="fa fa-check"></i><b>11.2</b> T-test and Chisq-test Visualization</a></li>
<li class="chapter" data-level="11.3" data-path="statistical-plot-with-ggplot2.html"><a href="statistical-plot-with-ggplot2.html#odds-ratio-and-95-confidence-interval"><i class="fa fa-check"></i><b>11.3</b> Odds ratio and 95% confidence interval</a></li>
<li class="chapter" data-level="11.4" data-path="statistical-plot-with-ggplot2.html"><a href="statistical-plot-with-ggplot2.html#Labeled"><i class="fa fa-check"></i><b>11.4</b> Multilevel and Labelled Data</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="statistical-plot-with-ggplot2.html"><a href="statistical-plot-with-ggplot2.html#introduction-1"><i class="fa fa-check"></i><b>11.4.1</b> introduction</a></li>
<li class="chapter" data-level="11.4.2" data-path="statistical-plot-with-ggplot2.html"><a href="statistical-plot-with-ggplot2.html#data-analysis-start"><i class="fa fa-check"></i><b>11.4.2</b> Data analysis start</a></li>
<li class="chapter" data-level="11.4.3" data-path="statistical-plot-with-ggplot2.html"><a href="statistical-plot-with-ggplot2.html#job-loss-psychological-aggravation-according-to-education-level"><i class="fa fa-check"></i><b>11.4.3</b> job loss, psychological aggravation according to Education level</a></li>
<li class="chapter" data-level="11.4.4" data-path="statistical-plot-with-ggplot2.html"><a href="statistical-plot-with-ggplot2.html#visulization-with-human-develop-index-stratification"><i class="fa fa-check"></i><b>11.4.4</b> Visulization with human develop index stratification</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="wave-form-data-visualization-example-for-public-health.html"><a href="wave-form-data-visualization-example-for-public-health.html"><i class="fa fa-check"></i><b>12</b> wave form data visualization example for public health</a>
<ul>
<li class="chapter" data-level="12.0.1" data-path="wave-form-data-visualization-example-for-public-health.html"><a href="wave-form-data-visualization-example-for-public-health.html#data-visualization-example-eeg-data"><i class="fa fa-check"></i><b>12.0.1</b> Data Visualization example (EEG data)</a></li>
<li class="chapter" data-level="12.0.2" data-path="wave-form-data-visualization-example-for-public-health.html"><a href="wave-form-data-visualization-example-for-public-health.html#introduction-2"><i class="fa fa-check"></i><b>12.0.2</b> Introduction</a></li>
<li class="chapter" data-level="12.0.3" data-path="wave-form-data-visualization-example-for-public-health.html"><a href="wave-form-data-visualization-example-for-public-health.html#dataset-and-data-step"><i class="fa fa-check"></i><b>12.0.3</b> Dataset and Data step</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="data-wrangling--text-value-handling.html"><a href="data-wrangling--text-value-handling.html"><i class="fa fa-check"></i><b>13</b> Data Wrangling- Text value Handling</a>
<ul>
<li class="chapter" data-level="13.1" data-path="data-wrangling--text-value-handling.html"><a href="data-wrangling--text-value-handling.html#동영상"><i class="fa fa-check"></i><b>13.1</b> 동영상</a></li>
<li class="chapter" data-level="13.2" data-path="data-wrangling--text-value-handling.html"><a href="data-wrangling--text-value-handling.html#문제-제기"><i class="fa fa-check"></i><b>13.2</b> 문제 제기</a></li>
<li class="chapter" data-level="13.3" data-path="data-wrangling--text-value-handling.html"><a href="data-wrangling--text-value-handling.html#split"><i class="fa fa-check"></i><b>13.3</b> split</a></li>
<li class="chapter" data-level="13.4" data-path="data-wrangling--text-value-handling.html"><a href="data-wrangling--text-value-handling.html#gather-pivot_longer"><i class="fa fa-check"></i><b>13.4</b> gather (pivot_longer)</a></li>
<li class="chapter" data-level="13.5" data-path="data-wrangling--text-value-handling.html"><a href="data-wrangling--text-value-handling.html#spread-pivot_wider"><i class="fa fa-check"></i><b>13.5</b> spread (pivot_wider)</a></li>
<li class="chapter" data-level="13.6" data-path="data-wrangling--text-value-handling.html"><a href="data-wrangling--text-value-handling.html#stringr"><i class="fa fa-check"></i><b>13.6</b> stringr</a>
<ul>
<li class="chapter" data-level="13.6.1" data-path="data-wrangling--text-value-handling.html"><a href="data-wrangling--text-value-handling.html#분진-노출자-찾기"><i class="fa fa-check"></i><b>13.6.1</b> 분진 노출자 찾기</a></li>
<li class="chapter" data-level="13.6.2" data-path="data-wrangling--text-value-handling.html"><a href="data-wrangling--text-value-handling.html#특정-문자-변환"><i class="fa fa-check"></i><b>13.6.2</b> 특정 문자 변환</a></li>
<li class="chapter" data-level="13.6.3" data-path="data-wrangling--text-value-handling.html"><a href="data-wrangling--text-value-handling.html#과제-1"><i class="fa fa-check"></i><b>13.6.3</b> 과제</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="web-scraping.html"><a href="web-scraping.html"><i class="fa fa-check"></i><b>14</b> Web Scraping</a>
<ul>
<li class="chapter" data-level="14.1" data-path="web-scraping.html"><a href="web-scraping.html#issue-of-covid19-in-korea"><i class="fa fa-check"></i><b>14.1</b> issue of COVID19 in Korea</a></li>
<li class="chapter" data-level="14.2" data-path="web-scraping.html"><a href="web-scraping.html#homework"><i class="fa fa-check"></i><b>14.2</b> homework</a>
<ul>
<li class="chapter" data-level="14.2.1" data-path="web-scraping.html"><a href="web-scraping.html#download-cumulative-covid19-death"><i class="fa fa-check"></i><b>14.2.1</b> download Cumulative covid19 death</a></li>
<li class="chapter" data-level="14.2.2" data-path="web-scraping.html"><a href="web-scraping.html#uk-italy-france-spain-usa-canada"><i class="fa fa-check"></i><b>14.2.2</b> UK, Italy, France, Spain, USA, Canada</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="web-scraping.html"><a href="web-scraping.html#review-of-title-from-google-scholar"><i class="fa fa-check"></i><b>14.3</b> Review of title from google scholar</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="web-scraping.html"><a href="web-scraping.html#googl-scholar"><i class="fa fa-check"></i><b>14.3.1</b> googl scholar</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="web-scraping.html"><a href="web-scraping.html#home-work-2"><i class="fa fa-check"></i><b>14.4</b> home work 2</a></li>
<li class="chapter" data-level="14.5" data-path="web-scraping.html"><a href="web-scraping.html#black-report-2"><i class="fa fa-check"></i><b>14.5</b> Black Report 2</a></li>
<li class="chapter" data-level="14.6" data-path="web-scraping.html"><a href="web-scraping.html#home-work-2-1"><i class="fa fa-check"></i><b>14.6</b> home work 2</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="webscraping-example-3-pubmed-and-r-with-endnote.html"><a href="webscraping-example-3-pubmed-and-r-with-endnote.html"><i class="fa fa-check"></i><b>15</b> WebScraping Example 3: PubMed and R with EndNote</a>
<ul>
<li class="chapter" data-level="15.1" data-path="webscraping-example-3-pubmed-and-r-with-endnote.html"><a href="webscraping-example-3-pubmed-and-r-with-endnote.html#pubmed-검색-방법"><i class="fa fa-check"></i><b>15.1</b> PubMed 검색 방법</a></li>
<li class="chapter" data-level="15.2" data-path="webscraping-example-3-pubmed-and-r-with-endnote.html"><a href="webscraping-example-3-pubmed-and-r-with-endnote.html#r-에서-pubmed-query-사용"><i class="fa fa-check"></i><b>15.2</b> R 에서 PubMed Query 사용</a></li>
<li class="chapter" data-level="15.3" data-path="webscraping-example-3-pubmed-and-r-with-endnote.html"><a href="webscraping-example-3-pubmed-and-r-with-endnote.html#pdf-자동-보고서"><i class="fa fa-check"></i><b>15.3</b> PDF 자동 보고서</a></li>
<li class="chapter" data-level="15.4" data-path="webscraping-example-3-pubmed-and-r-with-endnote.html"><a href="webscraping-example-3-pubmed-and-r-with-endnote.html#원문-pdf-찾기"><i class="fa fa-check"></i><b>15.4</b> 원문 PDF 찾기</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="date-and-time-series.html"><a href="date-and-time-series.html"><i class="fa fa-check"></i><b>16</b> Date and time series</a>
<ul>
<li class="chapter" data-level="16.1" data-path="date-and-time-series.html"><a href="date-and-time-series.html#date-create"><i class="fa fa-check"></i><b>16.1</b> Date create</a></li>
<li class="chapter" data-level="16.2" data-path="date-and-time-series.html"><a href="date-and-time-series.html#tutor-heat-wave-and-death"><i class="fa fa-check"></i><b>16.2</b> Tutor: heat wave and death</a>
<ul>
<li class="chapter" data-level="16.2.1" data-path="date-and-time-series.html"><a href="date-and-time-series.html#date-create-1"><i class="fa fa-check"></i><b>16.2.1</b> date create</a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="date-and-time-series.html"><a href="date-and-time-series.html#home-work"><i class="fa fa-check"></i><b>16.3</b> home work</a>
<ul>
<li class="chapter" data-level="16.3.1" data-path="date-and-time-series.html"><a href="date-and-time-series.html#home0"><i class="fa fa-check"></i><b>16.3.1</b> home0</a></li>
<li class="chapter" data-level="16.3.2" data-path="date-and-time-series.html"><a href="date-and-time-series.html#home-work1"><i class="fa fa-check"></i><b>16.3.2</b> home work1</a></li>
<li class="chapter" data-level="16.3.3" data-path="date-and-time-series.html"><a href="date-and-time-series.html#home-work2"><i class="fa fa-check"></i><b>16.3.3</b> home work2</a></li>
<li class="chapter" data-level="16.3.4" data-path="date-and-time-series.html"><a href="date-and-time-series.html#home-work3"><i class="fa fa-check"></i><b>16.3.4</b> home work3</a></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path="date-and-time-series.html"><a href="date-and-time-series.html#time-series-data-analysis"><i class="fa fa-check"></i><b>16.4</b> Time series data analysis</a>
<ul>
<li class="chapter" data-level="16.4.1" data-path="date-and-time-series.html"><a href="date-and-time-series.html#outside-사망에-대해서"><i class="fa fa-check"></i><b>16.4.1</b> outside 사망에 대해서</a></li>
</ul></li>
<li class="chapter" data-level="16.5" data-path="date-and-time-series.html"><a href="date-and-time-series.html#time-series-data-analysis-regression"><i class="fa fa-check"></i><b>16.5</b> Time series data analysis, regression</a></li>
<li class="chapter" data-level="16.6" data-path="date-and-time-series.html"><a href="date-and-time-series.html#introduction-3"><i class="fa fa-check"></i><b>16.6</b> introduction</a></li>
<li class="chapter" data-level="16.7" data-path="date-and-time-series.html"><a href="date-and-time-series.html#미세먼지와-심혈관사망"><i class="fa fa-check"></i><b>16.7</b> 미세먼지와 심혈관사망</a></li>
<li class="chapter" data-level="16.8" data-path="date-and-time-series.html"><a href="date-and-time-series.html#방법-tutor"><i class="fa fa-check"></i><b>16.8</b> 방법 tutor</a></li>
</ul></li>
<li class="part"><span><b>IV Repeat and Reproducibility</b></span></li>
<li class="chapter" data-level="17" data-path="repeated-analysis.html"><a href="repeated-analysis.html"><i class="fa fa-check"></i><b>17</b> Repeated analysis</a>
<ul>
<li class="chapter" data-level="17.1" data-path="repeated-analysis.html"><a href="repeated-analysis.html#추출"><i class="fa fa-check"></i><b>17.1</b> 추출</a></li>
<li class="chapter" data-level="17.2" data-path="repeated-analysis.html"><a href="repeated-analysis.html#파일-불러오기"><i class="fa fa-check"></i><b>17.2</b> 파일 불러오기</a>
<ul>
<li class="chapter" data-level="17.2.1" data-path="repeated-analysis.html"><a href="repeated-analysis.html#과제-2"><i class="fa fa-check"></i><b>17.2.1</b> 과제</a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path="repeated-analysis.html"><a href="repeated-analysis.html#분석-반복하기-change-point-찾기"><i class="fa fa-check"></i><b>17.3</b> 분석 반복하기 (change point 찾기)</a>
<ul>
<li class="chapter" data-level="17.3.1" data-path="repeated-analysis.html"><a href="repeated-analysis.html#자료-생성"><i class="fa fa-check"></i><b>17.3.1</b> 자료 생성</a></li>
<li class="chapter" data-level="17.3.2" data-path="repeated-analysis.html"><a href="repeated-analysis.html#가상의-threshold-값-수행해보기"><i class="fa fa-check"></i><b>17.3.2</b> 가상의 threshold 값 수행해보기</a></li>
<li class="chapter" data-level="17.3.3" data-path="repeated-analysis.html"><a href="repeated-analysis.html#과제-3"><i class="fa fa-check"></i><b>17.3.3</b> 과제</a></li>
</ul></li>
<li class="chapter" data-level="17.4" data-path="repeated-analysis.html"><a href="repeated-analysis.html#repeated-analysis-big-data"><i class="fa fa-check"></i><b>17.4</b> Repeated analysis (big data)</a>
<ul>
<li class="chapter" data-level="17.4.1" data-path="repeated-analysis.html"><a href="repeated-analysis.html#data-profile"><i class="fa fa-check"></i><b>17.4.1</b> Data profile</a></li>
<li class="chapter" data-level="17.4.2" data-path="repeated-analysis.html"><a href="repeated-analysis.html#data-handling-start"><i class="fa fa-check"></i><b>17.4.2</b> data handling start</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>V Communication</b></span></li>
<li class="chapter" data-level="18" data-path="r-markdown.html"><a href="r-markdown.html"><i class="fa fa-check"></i><b>18</b> R markdown</a>
<ul>
<li class="chapter" data-level="18.1" data-path="r-markdown.html"><a href="r-markdown.html#설치"><i class="fa fa-check"></i><b>18.1</b> 설치</a></li>
<li class="chapter" data-level="18.2" data-path="r-markdown.html"><a href="r-markdown.html#components"><i class="fa fa-check"></i><b>18.2</b> 3 components</a></li>
<li class="chapter" data-level="18.3" data-path="r-markdown.html"><a href="r-markdown.html#simple-tutor"><i class="fa fa-check"></i><b>18.3</b> simple tutor</a></li>
<li class="chapter" data-level="18.4" data-path="r-markdown.html"><a href="r-markdown.html#chunck-option"><i class="fa fa-check"></i><b>18.4</b> chunck option</a></li>
<li class="chapter" data-level="18.5" data-path="r-markdown.html"><a href="r-markdown.html#table-만들기"><i class="fa fa-check"></i><b>18.5</b> Table 만들기</a></li>
<li class="chapter" data-level="18.6" data-path="r-markdown.html"><a href="r-markdown.html#필독"><i class="fa fa-check"></i><b>18.6</b> 필독!</a></li>
<li class="chapter" data-level="18.7" data-path="r-markdown.html"><a href="r-markdown.html#동영상-1"><i class="fa fa-check"></i><b>18.7</b> 동영상</a></li>
<li class="chapter" data-level="18.8" data-path="r-markdown.html"><a href="r-markdown.html#과제-4"><i class="fa fa-check"></i><b>18.8</b> 과제</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="rmarkdown-and-reporting.html"><a href="rmarkdown-and-reporting.html"><i class="fa fa-check"></i><b>19</b> Rmarkdown and reporting</a>
<ul>
<li class="chapter" data-level="19.1" data-path="rmarkdown-and-reporting.html"><a href="rmarkdown-and-reporting.html#rmarkdown-and-word-office-down"><i class="fa fa-check"></i><b>19.1</b> Rmarkdown and Word (office down)</a></li>
<li class="chapter" data-level="19.2" data-path="rmarkdown-and-reporting.html"><a href="rmarkdown-and-reporting.html#rmarkdown-and-pdf"><i class="fa fa-check"></i><b>19.2</b> Rmarkdown and PDF</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="google-maps-platform.html"><a href="google-maps-platform.html"><i class="fa fa-check"></i><b>20</b> Google Maps Platform</a>
<ul>
<li class="chapter" data-level="20.1" data-path="google-maps-platform.html"><a href="google-maps-platform.html#google-tackeout"><i class="fa fa-check"></i><b>20.1</b> Google Tackeout</a></li>
<li class="chapter" data-level="20.2" data-path="google-maps-platform.html"><a href="google-maps-platform.html#data-visualization"><i class="fa fa-check"></i><b>20.2</b> Data visualization</a></li>
<li class="chapter" data-level="20.3" data-path="google-maps-platform.html"><a href="google-maps-platform.html#google-api"><i class="fa fa-check"></i><b>20.3</b> google API</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="leaflet.html"><a href="leaflet.html"><i class="fa fa-check"></i><b>21</b> Map using leaflet</a>
<ul>
<li class="chapter" data-level="21.1" data-path="leaflet.html"><a href="leaflet.html#leaflet-1"><i class="fa fa-check"></i><b>21.1</b> leaflet</a></li>
<li class="chapter" data-level="21.2" data-path="leaflet.html"><a href="leaflet.html#위치와-시간표시"><i class="fa fa-check"></i><b>21.2</b> 위치와 시간표시</a></li>
</ul></li>
<li class="chapter" data-level="22" data-path="shinyapps.html"><a href="shinyapps.html"><i class="fa fa-check"></i><b>22</b> shinyapps</a>
<ul>
<li class="chapter" data-level="22.1" data-path="shinyapps.html"><a href="shinyapps.html#설치-1"><i class="fa fa-check"></i><b>22.1</b> 설치</a></li>
<li class="chapter" data-level="22.2" data-path="shinyapps.html"><a href="shinyapps.html#예제"><i class="fa fa-check"></i><b>22.2</b> 예제</a></li>
<li class="chapter" data-level="22.3" data-path="shinyapps.html"><a href="shinyapps.html#예제-1-만들기"><i class="fa fa-check"></i><b>22.3</b> 예제 1 만들기</a>
<ul>
<li class="chapter" data-level="22.3.1" data-path="shinyapps.html"><a href="shinyapps.html#구조"><i class="fa fa-check"></i><b>22.3.1</b> 구조</a></li>
<li class="chapter" data-level="22.3.2" data-path="shinyapps.html"><a href="shinyapps.html#input-output"><i class="fa fa-check"></i><b>22.3.2</b> input, output</a></li>
<li class="chapter" data-level="22.3.3" data-path="shinyapps.html"><a href="shinyapps.html#과제-5"><i class="fa fa-check"></i><b>22.3.3</b> 과제</a></li>
</ul></li>
<li class="chapter" data-level="22.4" data-path="shinyapps.html"><a href="shinyapps.html#지도앱-만들기"><i class="fa fa-check"></i><b>22.4</b> 지도앱 만들기</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">DsPubs with R tutor book</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="repeated-analysis" class="section level1 hasAnchor" number="17">
<h1><span class="header-section-number">Chapter 17</span> Repeated analysis<a href="repeated-analysis.html#repeated-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>이번 시간에는 반복 작업을 줄이는 방법에 대해 이야기 해보겠습니다. 반복 작업을 코드로 단순화 하는 것은 여러 장점이 있습니다. 무엇보다 실수를 줄일수 있습니다. 그리고 시간도 절약할 수 있고요. 몇가지 알아보도록 하겠습니다.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="repeated-analysis.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="repeated-analysis.html#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb1-3"><a href="repeated-analysis.html#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span></code></pre></div>
<p>동영상은 여기에 있습니다. 말이 느리네요 유튜브 들어가서 1.2배도 들으시는게 더 좋을 것 같습니다.</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/r0k5dozRElY" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>
</iframe>
<p>실습자료는 <a href="https://dspubs.org/webapps/forum/open_data/heat.zip" class="uri">https://dspubs.org/webapps/forum/open_data/heat.zip</a> 에 있습니다.</p>
<div id="추출" class="section level2 hasAnchor" number="17.1">
<h2><span class="header-section-number">17.1</span> 추출<a href="repeated-analysis.html#추출" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>일자별로 미세먼지가 높은 날(Dusty)과 미세먼지가 없이 맑은 날(Clean)이 반복된다고 생각해보겠습니다. dusty가 4일, clean 이 6일 이라면 아래와 같습니다.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="repeated-analysis.html#cb2-1" aria-hidden="true" tabindex="-1"></a>weather <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;dusty&quot;</span>, <span class="st">&quot;clean&quot;</span>), <span class="at">times =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">6</span>))</span>
<span id="cb2-2"><a href="repeated-analysis.html#cb2-2" aria-hidden="true" tabindex="-1"></a>weather</span></code></pre></div>
<pre><code>##  [1] &quot;dusty&quot; &quot;dusty&quot; &quot;dusty&quot; &quot;dusty&quot; &quot;clean&quot; &quot;clean&quot; &quot;clean&quot; &quot;clean&quot; &quot;clean&quot;
## [10] &quot;clean&quot;</code></pre>
<p>그냥 무작위로 오늘은 어떤 날씨일지 해보겠습니다.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="repeated-analysis.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(weather, <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] &quot;clean&quot;</code></pre>
<p>이를 10000번 해보면 어떻게 될까요? 어떤 가요 거의 4:6의 비율로 나타나나요?</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="repeated-analysis.html#cb6-1" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb6-2"><a href="repeated-analysis.html#cb6-2" aria-hidden="true" tabindex="-1"></a>events <span class="ot">&lt;-</span> <span class="fu">replicate</span>(B, <span class="fu">sample</span>(weather, <span class="dv">1</span>))</span>
<span id="cb6-3"><a href="repeated-analysis.html#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(events)</span></code></pre></div>
<pre><code>## events
## clean dusty 
##  6026  3974</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="repeated-analysis.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(events))</span></code></pre></div>
<pre><code>## events
##  clean  dusty 
## 0.6026 0.3974</code></pre>
<p>중복 추출을 10000번 시행해 보면 어떻게 될 까요? 다음과 같이 시행해 볼 수 있습니다. 4:6의 비율이 유지되고 있나요?</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="repeated-analysis.html#cb10-1" aria-hidden="true" tabindex="-1"></a>events <span class="ot">&lt;-</span> <span class="fu">sample</span>(weather, B, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-2"><a href="repeated-analysis.html#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(events))</span></code></pre></div>
<pre><code>## events
##  clean  dusty 
## 0.5978 0.4022</code></pre>
</div>
<div id="파일-불러오기" class="section level2 hasAnchor" number="17.2">
<h2><span class="header-section-number">17.2</span> 파일 불러오기<a href="repeated-analysis.html#파일-불러오기" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>반복 작업 중 미세먼지 데이터 등을 불러오면 매일 엑셀이 하나씩 형성이 됩니다. 이를 모두 불러오는 것은 매우 힘든일입니다. 반복 작업을 통해 불러오겠습니다.</p>
<p>우선 여러 종류의 액셀을 형성해 보겠습니다. 구글클래스에서 heat.zip 파일을 다운 받고 폴더에 넣어 주세요.</p>
<p><img src="images/heat_folder.png" alt="heat folder" />
이중 ASOS 파일을 부러오겠습니다.
<img src="images/asos.png" alt="ASOS files" />
년도별 자료입니다. 현제는 몇년치 자료이고 모두 *.csv 파일 형태로 되어 있습니다. 이를 반복해서 불러보도록 하겠습니다.</p>
<p>우선 현제 폴더 위치를 알아야 합니다. 그리고 데이터가 있는 폴더 위치를 알아야 합니다. 현제 폴더는 /home/dspub/books/dspubbook 이네요.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="repeated-analysis.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getwd</span>()</span></code></pre></div>
<pre><code>## [1] &quot;/home/dspub/books/dspubbook&quot;</code></pre>
<p>여기에 <code>/data/heat/asos2</code> 에 파일이 있습니다. 즉, 아래와 같이 파일 폴더를 찾을 수 있습니다.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="repeated-analysis.html#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="fu">getwd</span>(),<span class="st">&quot;/data/heat/asos2&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span> )</span></code></pre></div>
<pre><code>## [1] &quot;/home/dspub/books/dspubbook/data/heat/asos2&quot;</code></pre>
<p>설정된 경로에 들어 있는 파일 목록을 보도록 하겠습니다.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="repeated-analysis.html#cb16-1" aria-hidden="true" tabindex="-1"></a>lpwd <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">getwd</span>(),<span class="st">&quot;/data/heat/asos2/&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span> )</span>
<span id="cb16-2"><a href="repeated-analysis.html#cb16-2" aria-hidden="true" tabindex="-1"></a>ldas <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb16-3"><a href="repeated-analysis.html#cb16-3" aria-hidden="true" tabindex="-1"></a>ldas <span class="ot">&lt;-</span> <span class="fu">dir</span>(<span class="at">path =</span> lpwd, </span>
<span id="cb16-4"><a href="repeated-analysis.html#cb16-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">pattern =</span> <span class="st">&#39;*.*&#39;</span>)</span>
<span id="cb16-5"><a href="repeated-analysis.html#cb16-5" aria-hidden="true" tabindex="-1"></a>ldas</span></code></pre></div>
<pre><code>##  [1] &quot;2000_ASOS.csv&quot; &quot;2001_ASOS.csv&quot; &quot;2002_ASOS.csv&quot; &quot;2003_ASOS.csv&quot;
##  [5] &quot;2004_ASOS.csv&quot; &quot;2005_ASOS.csv&quot; &quot;2006_ASOS.csv&quot; &quot;2007_ASOS.csv&quot;
##  [9] &quot;2008_ASOS.csv&quot; &quot;2009_ASOS.csv&quot; &quot;2010_ASOS.csv&quot; &quot;2011_ASOS.csv&quot;
## [13] &quot;2012_ASOS.csv&quot; &quot;2013_ASOS.csv&quot; &quot;2014_ASOS.csv&quot; &quot;2015_ASOS.csv&quot;
## [17] &quot;2016_ASOS.csv&quot; &quot;2017_ASOS.csv&quot; &quot;2018_ASOS.csv&quot; &quot;2019_ASOS.csv&quot;</code></pre>
<p>우선 첫번째 파일을 불러와보도록 하겠습니다.</p>
<p>빠른 속도를 위해서 <code>fread</code> 명령을 수행하겠습니다.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="repeated-analysis.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb18-2"><a href="repeated-analysis.html#cb18-2" aria-hidden="true" tabindex="-1"></a>test1 <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="fu">paste0</span>(lpwd, ldas[[<span class="dv">1</span>]] ))</span></code></pre></div>
<p>잘 불러와 졌나요? 그럼 모두 불러와 보겠습니다. 이때 이번 시간의 목적인 반복 작업이 수행됩니다.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="repeated-analysis.html#cb19-1" aria-hidden="true" tabindex="-1"></a>asos <span class="ot">&lt;-</span> <span class="fu">list</span>() <span class="co"># list 형식의 asos 만들기</span></span>
<span id="cb19-2"><a href="repeated-analysis.html#cb19-2" aria-hidden="true" tabindex="-1"></a>st <span class="ot">&lt;-</span><span class="fu">Sys.time</span>()</span>
<span id="cb19-3"><a href="repeated-analysis.html#cb19-3" aria-hidden="true" tabindex="-1"></a>asos <span class="ot">&lt;-</span> <span class="fu">lapply</span>(ldas, </span>
<span id="cb19-4"><a href="repeated-analysis.html#cb19-4" aria-hidden="true" tabindex="-1"></a>               <span class="cf">function</span>(dat){</span>
<span id="cb19-5"><a href="repeated-analysis.html#cb19-5" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">fread</span>(<span class="fu">paste0</span>(lpwd, dat ))</span>
<span id="cb19-6"><a href="repeated-analysis.html#cb19-6" aria-hidden="true" tabindex="-1"></a>               })</span>
<span id="cb19-7"><a href="repeated-analysis.html#cb19-7" aria-hidden="true" tabindex="-1"></a>et <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb19-8"><a href="repeated-analysis.html#cb19-8" aria-hidden="true" tabindex="-1"></a>et<span class="sc">-</span>st</span></code></pre></div>
<pre><code>## Time difference of 0.7504282 secs</code></pre>
<p>반복 작업이 되었습니다. 형성된 asos를 보도록 하겠습니다. 20개의 파일이 각각 list로 되어 있네요.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="repeated-analysis.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(asos)</span></code></pre></div>
<pre><code>##       Length Class      Mode
##  [1,] 60     data.table list
##  [2,] 60     data.table list
##  [3,] 60     data.table list
##  [4,] 60     data.table list
##  [5,] 60     data.table list
##  [6,] 60     data.table list
##  [7,] 60     data.table list
##  [8,] 60     data.table list
##  [9,] 60     data.table list
## [10,] 60     data.table list
## [11,] 60     data.table list
## [12,] 60     data.table list
## [13,] 60     data.table list
## [14,] 60     data.table list
## [15,] 60     data.table list
## [16,] 60     data.table list
## [17,] 60     data.table list
## [18,] 60     data.table list
## [19,] 60     data.table list
## [20,] 60     data.table list</code></pre>
<p>이제 모두 합쳐 하나의 데이터 프레임으로 만들어 보겠습니다.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="repeated-analysis.html#cb23-1" aria-hidden="true" tabindex="-1"></a>st <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb23-2"><a href="repeated-analysis.html#cb23-2" aria-hidden="true" tabindex="-1"></a>asos_dat <span class="ot">&lt;-</span> <span class="fu">do.call</span>(plyr<span class="sc">::</span>rbind.fill, asos)</span>
<span id="cb23-3"><a href="repeated-analysis.html#cb23-3" aria-hidden="true" tabindex="-1"></a>et <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb23-4"><a href="repeated-analysis.html#cb23-4" aria-hidden="true" tabindex="-1"></a>et <span class="sc">-</span>st</span></code></pre></div>
<pre><code>## Time difference of 0.6324322 secs</code></pre>
<p>이제 하나의 데이터가 되었습니다. 여기서 중요한 것은 <code>dir</code>을 통해 모든 데이터 list를 구하고, 이것을 lapply를 통해 한꺼번에 데이터를 불러온 다음, do.call을 통해 모두 rbind하는 것입니다. 매우 자주 사용되는 전처리 작업이므로 꼭 익숙해 지시기 바랍니다.</p>
<div id="과제-2" class="section level3 hasAnchor" number="17.2.1">
<h3><span class="header-section-number">17.2.1</span> 과제<a href="repeated-analysis.html#과제-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>heat_warning 데이터를 모두 불러와 보세요!
코드를 제출하시면 됩니다.</p>
</div>
</div>
<div id="분석-반복하기-change-point-찾기" class="section level2 hasAnchor" number="17.3">
<h2><span class="header-section-number">17.3</span> 분석 반복하기 (change point 찾기)<a href="repeated-analysis.html#분석-반복하기-change-point-찾기" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>threshold를 찾는 방법 중에 threshold point마다, piecewise regression을 반복해서 구하고, 최적의 모델을 찾는 방법을 사용할 수 있습니다. piecewise regression 의 간단한 설명은 다음과 같습니다</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/LENHutK1knQ" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>
</iframe>
<table>
<thead>
<tr class="header">
<th>threshold points (piecewise regression)</th>
<th>codes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>total</td>
<td>Resp = α + β1 · Dose + β2 ·( Dose – Ɵ) + + Ɛ0</td>
</tr>
<tr class="even">
<td>If Dose &lt; Ɵ</td>
<td>Resp= α + β1 · Dose + Ɛ0</td>
</tr>
<tr class="odd">
<td>If Dose &gt; Ɵ</td>
<td>Resp= α - β2 ·Ɵ +( β1 + β2 )· Dose + Ɛ0</td>
</tr>
<tr class="even">
<td>model selection</td>
<td>minimal AIC value</td>
</tr>
</tbody>
</table>
<div id="자료-생성" class="section level3 hasAnchor" number="17.3.1">
<h3><span class="header-section-number">17.3.1</span> 자료 생성<a href="repeated-analysis.html#자료-생성" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>아래 처럼 임로 데이터를 생성해 보았습니다. 어떤 유해물질 노출 (Dose) 에 따라 건강영향 (Resp) 가 나타났다고 생각해 보겠습니다. 그리고 일정량에서 threshold가 있다고 생각해보겠습니다.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="repeated-analysis.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">0</span>)</span>
<span id="cb25-2"><a href="repeated-analysis.html#cb25-2" aria-hidden="true" tabindex="-1"></a>dose <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">10</span>, <span class="fl">0.1</span>)</span>
<span id="cb25-3"><a href="repeated-analysis.html#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(dose)</span></code></pre></div>
<pre><code>## [1] 101</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="repeated-analysis.html#cb27-1" aria-hidden="true" tabindex="-1"></a>pb<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="fu">rnorm</span>(<span class="dv">50</span>, <span class="dv">0</span>, <span class="fl">0.001</span>), <span class="fu">rnorm</span>(<span class="dv">30</span>, <span class="dv">0</span>, <span class="fl">0.01</span>), <span class="fu">rnorm</span>(<span class="dv">10</span>, <span class="fl">0.1</span>, <span class="fl">0.05</span>),<span class="fu">rnorm</span>(<span class="dv">11</span>, <span class="sc">-</span><span class="fl">0.1</span>, <span class="fl">0.05</span>))</span>
<span id="cb27-2"><a href="repeated-analysis.html#cb27-2" aria-hidden="true" tabindex="-1"></a>resp <span class="ot">&lt;-</span><span class="dv">1</span><span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(<span class="sc">-</span>(dose<span class="dv">-5</span>)))<span class="sc">+</span><span class="fu">rnorm</span>(<span class="fu">length</span>(dose), <span class="dv">0</span>, <span class="fl">0.1</span>)<span class="sc">+</span>pb</span>
<span id="cb27-3"><a href="repeated-analysis.html#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="repeated-analysis.html#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dose, resp, <span class="at">xlab=</span><span class="st">&#39;Dose&#39;</span>, <span class="at">ylab=</span><span class="st">&#39;Response&#39;</span>, <span class="at">cex.lab=</span><span class="fl">1.5</span>, <span class="at">cex.axis=</span><span class="fl">1.5</span>, <span class="at">cex.main=</span><span class="fl">1.5</span>, <span class="at">cex.sub=</span><span class="fl">1.5</span>)</span></code></pre></div>
<p><img src="testbook_files/figure-html/cohort%20threshold-1.png" width="672" /></p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="repeated-analysis.html#cb28-1" aria-hidden="true" tabindex="-1"></a>cohort<span class="ot">&lt;-</span><span class="fu">data.frame</span>(dose, resp, pb)</span></code></pre></div>
</div>
<div id="가상의-threshold-값-수행해보기" class="section level3 hasAnchor" number="17.3.2">
<h3><span class="header-section-number">17.3.2</span> 가상의 threshold 값 수행해보기<a href="repeated-analysis.html#가상의-threshold-값-수행해보기" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>한 1에서 5 사이에 있어 보입니다. 이를 통해 예상되는 matrix (outdata)를 구해보았습니다.
outdata의 행의 이름을 <code>threshold point</code>에 따라 <code>intercept</code>, <code>beta for before threshold, and its p value</code>, <code>beta for post threshold and its pvalue</code>와 그때은 <code>AIC 값</code>을 구해보겠습니다 .
우선 하나만 구해보겠습니다. therhold가 1일때와 5일때를 를 가정해 보겠습니다.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="repeated-analysis.html#cb29-1" aria-hidden="true" tabindex="-1"></a>cpdose <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(dose <span class="sc">-</span><span class="dv">1</span> <span class="sc">&gt;</span><span class="dv">0</span>, dose <span class="sc">-</span><span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb29-2"><a href="repeated-analysis.html#cb29-2" aria-hidden="true" tabindex="-1"></a>cpm <span class="ot">&lt;-</span> <span class="fu">glm</span>(resp <span class="sc">~</span> dose <span class="sc">+</span> cpdose)</span>
<span id="cb29-3"><a href="repeated-analysis.html#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cpm)<span class="sc">$</span>aic</span></code></pre></div>
<pre><code>## [1] -92.20184</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="repeated-analysis.html#cb31-1" aria-hidden="true" tabindex="-1"></a>cpdose <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(dose <span class="sc">-</span><span class="dv">5</span> <span class="sc">&gt;</span><span class="dv">0</span>, dose <span class="sc">-</span><span class="dv">5</span>, <span class="dv">0</span>)</span>
<span id="cb31-2"><a href="repeated-analysis.html#cb31-2" aria-hidden="true" tabindex="-1"></a>cpm <span class="ot">&lt;-</span> <span class="fu">glm</span>(resp <span class="sc">~</span> dose <span class="sc">+</span> cpdose)</span>
<span id="cb31-3"><a href="repeated-analysis.html#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cpm)<span class="sc">$</span>aic</span></code></pre></div>
<pre><code>## [1] -86.9744</code></pre>
<p>어떤 가정이 모델 적합도를 높이나요? 네 threshold가 1일 때 입니다. 그럼 2랑도, 2.5랑도 비교해 봐야겠지요. 이때 반복 분석을 수행해보도록 하겠습니다.</p>
<p>위의 모델을 함수로 만들었습니다</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="repeated-analysis.html#cb33-1" aria-hidden="true" tabindex="-1"></a>thr_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(thres){</span>
<span id="cb33-2"><a href="repeated-analysis.html#cb33-2" aria-hidden="true" tabindex="-1"></a>cpdose <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(dose <span class="sc">-</span> thres <span class="sc">&gt;</span><span class="dv">0</span>, dose <span class="sc">-</span> thres, <span class="dv">0</span>)</span>
<span id="cb33-3"><a href="repeated-analysis.html#cb33-3" aria-hidden="true" tabindex="-1"></a>cpm    <span class="ot">&lt;-</span> <span class="fu">glm</span>(resp <span class="sc">~</span> dose <span class="sc">+</span> cpdose)</span>
<span id="cb33-4"><a href="repeated-analysis.html#cb33-4" aria-hidden="true" tabindex="-1"></a>aic    <span class="ot">&lt;-</span> <span class="fu">summary</span>(cpm)<span class="sc">$</span>aic</span>
<span id="cb33-5"><a href="repeated-analysis.html#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb33-6"><a href="repeated-analysis.html#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;threshold&#39;</span> <span class="ot">=</span> thres,</span>
<span id="cb33-7"><a href="repeated-analysis.html#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;aic&#39;</span>       <span class="ot">=</span> aic)</span>
<span id="cb33-8"><a href="repeated-analysis.html#cb33-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>이것을 돌릴 범위를 정해보겠습니다.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="repeated-analysis.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 이게 어떤 의미 일까요?</span></span>
<span id="cb34-2"><a href="repeated-analysis.html#cb34-2" aria-hidden="true" tabindex="-1"></a>dose[<span class="fu">which</span>(dose <span class="sc">==</span> <span class="dv">1</span>)<span class="sc">:</span><span class="fu">which</span>(dose <span class="sc">==</span> <span class="dv">5</span>)]</span></code></pre></div>
<pre><code>##  [1] 1.0 1.1 1.2 1.3 1.4 1.5 1.6 1.7 1.8 1.9 2.0 2.1 2.2 2.3 2.4 2.5 2.6 2.7 2.8
## [20] 2.9 3.0 3.1 3.2 3.3 3.4 3.5 3.6 3.7 3.8 3.9 4.0 4.1 4.2 4.3 4.4 4.5 4.6 4.7
## [39] 4.8 4.9 5.0</code></pre>
<p>이제 반복해서 작업해 보겠습니다.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="repeated-analysis.html#cb36-1" aria-hidden="true" tabindex="-1"></a>simul_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb36-2"><a href="repeated-analysis.html#cb36-2" aria-hidden="true" tabindex="-1"></a>simul_list <span class="ot">&lt;-</span> <span class="fu">lapply</span>(dose[<span class="fu">which</span>(dose <span class="sc">==</span><span class="dv">1</span>)<span class="sc">:</span><span class="fu">which</span>(dose <span class="sc">==</span><span class="dv">5</span>)],                     thr_fun</span>
<span id="cb36-3"><a href="repeated-analysis.html#cb36-3" aria-hidden="true" tabindex="-1"></a>                     )</span></code></pre></div>
<p>이제 데이터 프레임으로 만들어 보겠습니다.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="repeated-analysis.html#cb37-1" aria-hidden="true" tabindex="-1"></a>simul_dat <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, simul_list)</span></code></pre></div>
<p>그림을 그려보겠습니다.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="repeated-analysis.html#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb38-2"><a href="repeated-analysis.html#cb38-2" aria-hidden="true" tabindex="-1"></a>opt.thres <span class="ot">&lt;-</span> simul_dat<span class="sc">$</span>threshold[<span class="fu">which.min</span>(simul_dat<span class="sc">$</span>aic)]</span>
<span id="cb38-3"><a href="repeated-analysis.html#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="repeated-analysis.html#cb38-4" aria-hidden="true" tabindex="-1"></a>simul_dat <span class="sc">%&gt;%</span></span>
<span id="cb38-5"><a href="repeated-analysis.html#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> threshold, <span class="at">y =</span> aic)) <span class="sc">+</span></span>
<span id="cb38-6"><a href="repeated-analysis.html#cb38-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb38-7"><a href="repeated-analysis.html#cb38-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> opt.thres) <span class="sc">+</span></span>
<span id="cb38-8"><a href="repeated-analysis.html#cb38-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">x =</span> opt.thres <span class="sc">+</span> <span class="fl">0.8</span>, <span class="at">y =</span> <span class="sc">-</span><span class="dv">90</span>, <span class="at">color =</span> <span class="st">&#39;red&#39;</span>, </span>
<span id="cb38-9"><a href="repeated-analysis.html#cb38-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">round</span>(opt.thres, <span class="dv">3</span>), <span class="st">&#39;점에서 최소 AIC를 보입니다.&#39;</span> )) <span class="sc">+</span></span>
<span id="cb38-10"><a href="repeated-analysis.html#cb38-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="testbook_files/figure-html/threshold%20pcw%20lapply-1.png" width="672" /></p>
<p>즉 2.1에서 threshold를 잡아 모델을 그리면 가장 적합함을 알 수 있습니다.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="repeated-analysis.html#cb39-1" aria-hidden="true" tabindex="-1"></a>thres <span class="ot">=</span> <span class="fl">2.1</span></span>
<span id="cb39-2"><a href="repeated-analysis.html#cb39-2" aria-hidden="true" tabindex="-1"></a>f_cpdose <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(dose <span class="sc">-</span> thres <span class="sc">&gt;</span><span class="dv">0</span>, dose <span class="sc">-</span> thres, <span class="dv">0</span>)</span>
<span id="cb39-3"><a href="repeated-analysis.html#cb39-3" aria-hidden="true" tabindex="-1"></a>f_cpm    <span class="ot">&lt;-</span> <span class="fu">glm</span>(resp <span class="sc">~</span> dose <span class="sc">+</span> f_cpdose)</span></code></pre></div>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="repeated-analysis.html#cb40-1" aria-hidden="true" tabindex="-1"></a>prepwlm <span class="ot">&lt;-</span> <span class="fu">predict</span>(f_cpm)</span>
<span id="cb40-2"><a href="repeated-analysis.html#cb40-2" aria-hidden="true" tabindex="-1"></a>scaleFUN <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">sprintf</span>(<span class="st">&quot;%.2f&quot;</span>, x)</span>
<span id="cb40-3"><a href="repeated-analysis.html#cb40-3" aria-hidden="true" tabindex="-1"></a>cohort <span class="sc">%&gt;%</span></span>
<span id="cb40-4"><a href="repeated-analysis.html#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span> dose, <span class="at">y =</span> resp)) <span class="sc">+</span></span>
<span id="cb40-5"><a href="repeated-analysis.html#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb40-6"><a href="repeated-analysis.html#cb40-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb40-7"><a href="repeated-analysis.html#cb40-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scaleFUN) <span class="sc">+</span></span>
<span id="cb40-8"><a href="repeated-analysis.html#cb40-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> prepwlm), <span class="at">color =</span><span class="st">&#39;red&#39;</span>)</span></code></pre></div>
<p><img src="testbook_files/figure-html/threshold%20model%20fitting%20predict-1.png" width="672" /></p>
</div>
<div id="과제-3" class="section level3 hasAnchor" number="17.3.3">
<h3><span class="header-section-number">17.3.3</span> 과제<a href="repeated-analysis.html#과제-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>dose가 6부터 10사일에서 change point 가 있다고 가정하고 반복 분석해서 AIC값이 최저인 change point를 찾아 부세요
code를 올려주시면 됩니다.</p>
</div>
</div>
<div id="repeated-analysis-big-data" class="section level2 hasAnchor" number="17.4">
<h2><span class="header-section-number">17.4</span> Repeated analysis (big data)<a href="repeated-analysis.html#repeated-analysis-big-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>반복 작업을 하는 이유는 여러가지가 있는데요, 어떤 것은 R 의 메모리로는 감당할 수 없는 데이터가 있습니다. 이러한 데이터를 통해 작업을 하는 방법을 이야기 해보겠습니다.</p>
<p><br></p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/R2SuYmQGutw" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>
</iframe>
<div id="data-profile" class="section level3 hasAnchor" number="17.4.1">
<h3><span class="header-section-number">17.4.1</span> Data profile<a href="repeated-analysis.html#data-profile" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ol style="list-style-type: decimal">
<li>데이터
2015년부터 2020년까지 사업 결과 데이터 약 1T 정도의 데이터</li>
</ol>
</div>
<div id="data-handling-start" class="section level3 hasAnchor" number="17.4.2">
<h3><span class="header-section-number">17.4.2</span> data handling start<a href="repeated-analysis.html#data-handling-start" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="각-데이터별-변동-변수-생산" class="section level4 hasAnchor" number="17.4.2.1">
<h4><span class="header-section-number">17.4.2.1</span> 각 데이터별 변동 변수 생산<a href="repeated-analysis.html#각-데이터별-변동-변수-생산" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>반복 클리닝을 위한 컴퓨터 준비</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="repeated-analysis.html#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co">#simple idea 1: just use counting number of each activity</span></span>
<span id="cb41-2"><a href="repeated-analysis.html#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="co"># is someone use regular option, the counting number might be sqired..</span></span>
<span id="cb41-3"><a href="repeated-analysis.html#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tic</span>()</span>
<span id="cb41-4"><a href="repeated-analysis.html#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>())</span>
<span id="cb41-5"><a href="repeated-analysis.html#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(shiny)) <span class="fu">install.packages</span>(<span class="st">&#39;shiny&#39;</span>); <span class="fu">library</span>(shiny); </span>
<span id="cb41-6"><a href="repeated-analysis.html#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(DBI)) <span class="fu">install.packages</span>(<span class="st">&#39;DBI&#39;</span>); <span class="fu">library</span>(DBI)</span>
<span id="cb41-7"><a href="repeated-analysis.html#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(odbc)) <span class="fu">install.packages</span>(<span class="st">&#39;odbc&#39;</span>); <span class="fu">library</span>(odbc)</span>
<span id="cb41-8"><a href="repeated-analysis.html#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(DT)) <span class="fu">install.packages</span>(<span class="st">&#39;DT&#39;</span>); <span class="fu">library</span>(DT)</span>
<span id="cb41-9"><a href="repeated-analysis.html#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(tidyverse)) <span class="fu">install.packages</span>(<span class="st">&#39;tidyverse&#39;</span>); <span class="fu">library</span>(tidyverse)</span>
<span id="cb41-10"><a href="repeated-analysis.html#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(tidyverse)) <span class="fu">install.packages</span>(<span class="st">&#39;tidyverse&#39;</span>)</span>
<span id="cb41-11"><a href="repeated-analysis.html#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(data.table)) <span class="fu">install.packages</span>(<span class="st">&#39;data.table&#39;</span>)</span>
<span id="cb41-12"><a href="repeated-analysis.html#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(skimr)) <span class="fu">install.packages</span>(<span class="st">&#39;skimr&#39;</span>)</span>
<span id="cb41-13"><a href="repeated-analysis.html#cb41-13" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(parallel)) <span class="fu">install.packages</span>(<span class="st">&#39;parallel&#39;</span>)</span>
<span id="cb41-14"><a href="repeated-analysis.html#cb41-14" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(feather)) <span class="fu">install.packages</span>(<span class="st">&#39;feather&#39;</span>)</span>
<span id="cb41-15"><a href="repeated-analysis.html#cb41-15" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(skimr)) <span class="fu">install.packages</span>(<span class="st">&#39;skimr&#39;</span>)</span>
<span id="cb41-16"><a href="repeated-analysis.html#cb41-16" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(tictoc)) <span class="fu">install.packages</span>(<span class="st">&#39;tictoc&#39;</span>)</span>
<span id="cb41-17"><a href="repeated-analysis.html#cb41-17" aria-hidden="true" tabindex="-1"></a><span class="fu">detectCores</span>()</span>
<span id="cb41-18"><a href="repeated-analysis.html#cb41-18" aria-hidden="true" tabindex="-1"></a><span class="do">## nmon: monitor cpu</span></span>
<span id="cb41-19"><a href="repeated-analysis.html#cb41-19" aria-hidden="true" tabindex="-1"></a><span class="do">## clear cash</span></span>
<span id="cb41-20"><a href="repeated-analysis.html#cb41-20" aria-hidden="true" tabindex="-1"></a>passworddspub <span class="ot">=</span> <span class="fu">readRDS</span>(<span class="st">&quot;secure/password.rds&quot;</span>)</span>
<span id="cb41-21"><a href="repeated-analysis.html#cb41-21" aria-hidden="true" tabindex="-1"></a><span class="co"># 메모리 초기화</span></span>
<span id="cb41-22"><a href="repeated-analysis.html#cb41-22" aria-hidden="true" tabindex="-1"></a><span class="fu">system</span>(<span class="st">&quot;sudo -kS sh -c &#39;echo 3 &gt;/proc/sys/vm/drop_caches&#39;&quot;</span>, <span class="at">input=</span>passworddspub)</span>
<span id="cb41-23"><a href="repeated-analysis.html#cb41-23" aria-hidden="true" tabindex="-1"></a><span class="co">#system(&quot;sudo -kS apt-get clean&quot;, input=passworddspub)</span></span>
<span id="cb41-24"><a href="repeated-analysis.html#cb41-24" aria-hidden="true" tabindex="-1"></a><span class="co">#system(&quot;sudo -kS lshw -class disk&quot;, input=passworddspub)</span></span>
<span id="cb41-25"><a href="repeated-analysis.html#cb41-25" aria-hidden="true" tabindex="-1"></a><span class="co">#system(&quot;systemd-resolve --statistics&quot;)</span></span>
<span id="cb41-26"><a href="repeated-analysis.html#cb41-26" aria-hidden="true" tabindex="-1"></a><span class="co">#system(&quot;systemd-resolve --flush-caches&quot;)</span></span>
<span id="cb41-27"><a href="repeated-analysis.html#cb41-27" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>())</span>
<span id="cb41-28"><a href="repeated-analysis.html#cb41-28" aria-hidden="true" tabindex="-1"></a><span class="fu">gc</span>()</span></code></pre></div>
<p>월별 데이터 불러오기</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="repeated-analysis.html#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="do">## gloabl</span></span>
<span id="cb42-2"><a href="repeated-analysis.html#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="do">###########################################################</span></span>
<span id="cb42-3"><a href="repeated-analysis.html#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 향후 여기 숫자를  loop로 바꾸면서 반복 분석             # </span></span>
<span id="cb42-4"><a href="repeated-analysis.html#cb42-4" aria-hidden="true" tabindex="-1"></a>                LOOP_data_number<span class="ot">=</span> <span class="dv">1</span>                       <span class="co">#</span></span>
<span id="cb42-5"><a href="repeated-analysis.html#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="co">#                                                         #</span></span>
<span id="cb42-6"><a href="repeated-analysis.html#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="do">###########################################################</span></span>
<span id="cb42-7"><a href="repeated-analysis.html#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 1,2</span></span>
<span id="cb42-8"><a href="repeated-analysis.html#cb42-8" aria-hidden="true" tabindex="-1"></a><span class="co">#LOOP_hospital_number =1</span></span>
<span id="cb42-9"><a href="repeated-analysis.html#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="co">#LOOP_variable_number = 1</span></span>
<span id="cb42-10"><a href="repeated-analysis.html#cb42-10" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">=</span> <span class="fu">list</span>() <span class="co"># sliced data set by each hospital number</span></span>
<span id="cb42-11"><a href="repeated-analysis.html#cb42-11" aria-hidden="true" tabindex="-1"></a>process <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb42-12"><a href="repeated-analysis.html#cb42-12" aria-hidden="true" tabindex="-1"></a>passworddspub <span class="ot">=</span> <span class="fu">readRDS</span>(<span class="st">&quot;secure/password.rds&quot;</span>)</span>
<span id="cb42-13"><a href="repeated-analysis.html#cb42-13" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb42-14"><a href="repeated-analysis.html#cb42-14" aria-hidden="true" tabindex="-1"></a><span class="do">## data names coresponding to  data_number</span></span>
<span id="cb42-15"><a href="repeated-analysis.html#cb42-15" aria-hidden="true" tabindex="-1"></a>lpwd <span class="ot">&lt;-</span> <span class="st">&quot;/home/dspub/locdb/ssd970/hpbig/&quot;</span></span>
<span id="cb42-16"><a href="repeated-analysis.html#cb42-16" aria-hidden="true" tabindex="-1"></a>data_names <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb42-17"><a href="repeated-analysis.html#cb42-17" aria-hidden="true" tabindex="-1"></a>data_names <span class="ot">&lt;-</span> <span class="fu">dir</span>(<span class="at">path=</span> lpwd, <span class="at">pattern =</span> <span class="st">&#39;*.txt&#39;</span>)</span>
<span id="cb42-18"><a href="repeated-analysis.html#cb42-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-19"><a href="repeated-analysis.html#cb42-19" aria-hidden="true" tabindex="-1"></a>data_names</span>
<span id="cb42-20"><a href="repeated-analysis.html#cb42-20" aria-hidden="true" tabindex="-1"></a><span class="do">## data, data pwd</span></span>
<span id="cb42-21"><a href="repeated-analysis.html#cb42-21" aria-hidden="true" tabindex="-1"></a>data_file <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s%s&quot;</span>, lpwd, data_names[LOOP_data_number] )</span>
<span id="cb42-22"><a href="repeated-analysis.html#cb42-22" aria-hidden="true" tabindex="-1"></a>data_file</span>
<span id="cb42-23"><a href="repeated-analysis.html#cb42-23" aria-hidden="true" tabindex="-1"></a><span class="do">## get header name and tolower (whynot)</span></span>
<span id="cb42-24"><a href="repeated-analysis.html#cb42-24" aria-hidden="true" tabindex="-1"></a>cnames <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">fread</span>(data_file, <span class="at">nrows =</span> <span class="dv">0</span>, <span class="at">header =</span> T)) <span class="sc">%&gt;%</span> <span class="fu">tolower</span>()</span>
<span id="cb42-25"><a href="repeated-analysis.html#cb42-25" aria-hidden="true" tabindex="-1"></a>cnames</span>
<span id="cb42-26"><a href="repeated-analysis.html#cb42-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-27"><a href="repeated-analysis.html#cb42-27" aria-hidden="true" tabindex="-1"></a><span class="do">### read ykiho only : ykiho is unique number of each hospital</span></span>
<span id="cb42-28"><a href="repeated-analysis.html#cb42-28" aria-hidden="true" tabindex="-1"></a>hop_list <span class="ot">&lt;-</span> <span class="fu">fread</span>(data_file, <span class="at">select=</span><span class="fu">c</span>(<span class="st">&#39;YKIHO&#39;</span>))</span>
<span id="cb42-29"><a href="repeated-analysis.html#cb42-29" aria-hidden="true" tabindex="-1"></a>hop_list1 <span class="ot">&lt;-</span> hop_list <span class="sc">%&gt;%</span> <span class="fu">unique</span>()</span>
<span id="cb42-30"><a href="repeated-analysis.html#cb42-30" aria-hidden="true" tabindex="-1"></a>hop_length <span class="ot">&lt;-</span> <span class="fu">nrow</span>(hop_list1)</span>
<span id="cb42-31"><a href="repeated-analysis.html#cb42-31" aria-hidden="true" tabindex="-1"></a>hop_length</span>
<span id="cb42-32"><a href="repeated-analysis.html#cb42-32" aria-hidden="true" tabindex="-1"></a>hop_list1</span></code></pre></div>
<p>각 월별 n 번째 기관 데이트를 불러오고 이를 통해 모든 변수에 대한 변동 변수 생성하는 함수 만들기</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="repeated-analysis.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># n번째 YKIOH 가져오기 </span></span>
<span id="cb43-2"><a href="repeated-analysis.html#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="do">## data location (R 메모리 사용 안하게 하기 위해 linux unix 에서 실행)</span></span>
<span id="cb43-3"><a href="repeated-analysis.html#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="repeated-analysis.html#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="do">## get 1st ho_list indexing data from all data</span></span>
<span id="cb43-5"><a href="repeated-analysis.html#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="co">#dataFiles</span></span>
<span id="cb43-6"><a href="repeated-analysis.html#cb43-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-7"><a href="repeated-analysis.html#cb43-7" aria-hidden="true" tabindex="-1"></a>hospital_long <span class="ot">=</span> <span class="cf">function</span>(LOOP_hospital_number){</span>
<span id="cb43-8"><a href="repeated-analysis.html#cb43-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-9"><a href="repeated-analysis.html#cb43-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 리눅스 자체 함수 사용</span></span>
<span id="cb43-10"><a href="repeated-analysis.html#cb43-10" aria-hidden="true" tabindex="-1"></a>    command <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(</span>
<span id="cb43-11"><a href="repeated-analysis.html#cb43-11" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;grep --text &#39;,%s,&#39; %s&quot;</span>,</span>
<span id="cb43-12"><a href="repeated-analysis.html#cb43-12" aria-hidden="true" tabindex="-1"></a>      hop_list1[LOOP_hospital_number] <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>(),</span>
<span id="cb43-13"><a href="repeated-analysis.html#cb43-13" aria-hidden="true" tabindex="-1"></a>      data_file</span>
<span id="cb43-14"><a href="repeated-analysis.html#cb43-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb43-15"><a href="repeated-analysis.html#cb43-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 메모리 사용 함수</span></span>
<span id="cb43-16"><a href="repeated-analysis.html#cb43-16" aria-hidden="true" tabindex="-1"></a>    <span class="do">### get just one hospital data (hosptial level data step)</span></span>
<span id="cb43-17"><a href="repeated-analysis.html#cb43-17" aria-hidden="true" tabindex="-1"></a>    dt[[LOOP_hospital_number]] <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="at">cmd =</span> command)</span>
<span id="cb43-18"><a href="repeated-analysis.html#cb43-18" aria-hidden="true" tabindex="-1"></a>    <span class="do">## loop start</span></span>
<span id="cb43-19"><a href="repeated-analysis.html#cb43-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(dt[[LOOP_hospital_number]]) <span class="ot">&lt;-</span> cnames</span>
<span id="cb43-20"><a href="repeated-analysis.html#cb43-20" aria-hidden="true" tabindex="-1"></a>    <span class="do">## long file function just one column (column level data step)</span></span>
<span id="cb43-21"><a href="repeated-analysis.html#cb43-21" aria-hidden="true" tabindex="-1"></a>    ducon <span class="ot">=</span> <span class="cf">function</span>(i){</span>
<span id="cb43-22"><a href="repeated-analysis.html#cb43-22" aria-hidden="true" tabindex="-1"></a>      dt[[LOOP_hospital_number]] <span class="sc">%&gt;%</span></span>
<span id="cb43-23"><a href="repeated-analysis.html#cb43-23" aria-hidden="true" tabindex="-1"></a>          <span class="fu">group_by</span>(dt[[LOOP_hospital_number]][, ..i]) <span class="sc">%&gt;%</span></span>
<span id="cb43-24"><a href="repeated-analysis.html#cb43-24" aria-hidden="true" tabindex="-1"></a>          <span class="fu">count</span>() <span class="sc">%&gt;%</span></span>
<span id="cb43-25"><a href="repeated-analysis.html#cb43-25" aria-hidden="true" tabindex="-1"></a>          <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb43-26"><a href="repeated-analysis.html#cb43-26" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">nn =</span> <span class="fu">colnames</span>(.)[<span class="dv">1</span>], <span class="at">ll =</span> <span class="fu">nrow</span>(.)) <span class="sc">%&gt;%</span></span>
<span id="cb43-27"><a href="repeated-analysis.html#cb43-27" aria-hidden="true" tabindex="-1"></a>          <span class="fu">select</span>(nn, ll) <span class="sc">%&gt;%</span></span>
<span id="cb43-28"><a href="repeated-analysis.html#cb43-28" aria-hidden="true" tabindex="-1"></a>          <span class="fu">unique</span>()</span>
<span id="cb43-29"><a href="repeated-analysis.html#cb43-29" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb43-30"><a href="repeated-analysis.html#cb43-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># data step start</span></span>
<span id="cb43-31"><a href="repeated-analysis.html#cb43-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Multicore 사용 시작 core number = 22 개 (전체 48개의 절반 이하 사용 권장)</span></span>
<span id="cb43-32"><a href="repeated-analysis.html#cb43-32" aria-hidden="true" tabindex="-1"></a>    all_list    <span class="ot">=</span> <span class="fu">mclapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(<span class="fu">colnames</span>(dt[[LOOP_hospital_number]]))<span class="sc">%&gt;%</span><span class="fu">as.numeric</span>(), ducon, <span class="at">mc.cores =</span> <span class="dv">22</span>)</span>
<span id="cb43-33"><a href="repeated-analysis.html#cb43-33" aria-hidden="true" tabindex="-1"></a>    all_list_m  <span class="ot">=</span> <span class="fu">do.call</span>(rbind, all_list)</span>
<span id="cb43-34"><a href="repeated-analysis.html#cb43-34" aria-hidden="true" tabindex="-1"></a>    all_list_mh <span class="ot">=</span>  all_list_m <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">key =</span> hop_list1[LOOP_hospital_number] <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>())</span>
<span id="cb43-35"><a href="repeated-analysis.html#cb43-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span>(<span class="at">list=</span><span class="st">&#39;all_list_m&#39;</span>)</span>
<span id="cb43-36"><a href="repeated-analysis.html#cb43-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span>(<span class="at">list=</span><span class="st">&#39;all_list&#39;</span>)</span>
<span id="cb43-37"><a href="repeated-analysis.html#cb43-37" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span>(all_list_mh)</span>
<span id="cb43-38"><a href="repeated-analysis.html#cb43-38" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>상기 변동 변수 생성 함수 반복 실행함 multicore 와 loop 사용하는 하이브리드 방식</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="repeated-analysis.html#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># hibrid multicore</span></span>
<span id="cb44-2"><a href="repeated-analysis.html#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="do">## director create</span></span>
<span id="cb44-3"><a href="repeated-analysis.html#cb44-3" aria-hidden="true" tabindex="-1"></a>datasave_foler <span class="ot">=</span>  data_names[LOOP_data_number] <span class="sc">%&gt;%</span> <span class="fu">str_replace</span>(., <span class="st">&quot;.txt&quot;</span>, <span class="st">&quot;&quot;</span>)</span>
<span id="cb44-4"><a href="repeated-analysis.html#cb44-4" aria-hidden="true" tabindex="-1"></a>datasave_foler</span>
<span id="cb44-5"><a href="repeated-analysis.html#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%s/%s&quot;</span>, <span class="st">&quot;process&quot;</span>, datasave_foler))</span>
<span id="cb44-6"><a href="repeated-analysis.html#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="co"># create list</span></span>
<span id="cb44-7"><a href="repeated-analysis.html#cb44-7" aria-hidden="true" tabindex="-1"></a>hop_length <span class="co"># 몇개 병원, </span></span>
<span id="cb44-8"><a href="repeated-analysis.html#cb44-8" aria-hidden="true" tabindex="-1"></a>hop_list <span class="ot">=</span> <span class="fu">list</span>()  <span class="co"># </span></span>
<span id="cb44-9"><a href="repeated-analysis.html#cb44-9" aria-hidden="true" tabindex="-1"></a>hop_list_m <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb44-10"><a href="repeated-analysis.html#cb44-10" aria-hidden="true" tabindex="-1"></a><span class="fu">tic</span>()</span>
<span id="cb44-11"><a href="repeated-analysis.html#cb44-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (z <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>){</span>
<span id="cb44-12"><a href="repeated-analysis.html#cb44-12" aria-hidden="true" tabindex="-1"></a><span class="co">#clear cash</span></span>
<span id="cb44-13"><a href="repeated-analysis.html#cb44-13" aria-hidden="true" tabindex="-1"></a>passworddspub <span class="ot">=</span> <span class="fu">readRDS</span>(<span class="st">&quot;secure/password.rds&quot;</span>)</span>
<span id="cb44-14"><a href="repeated-analysis.html#cb44-14" aria-hidden="true" tabindex="-1"></a><span class="fu">system</span>(<span class="st">&quot;sudo -kS sh -c &#39;echo 3 &gt;/proc/sys/vm/drop_caches&#39;&quot;</span>, <span class="at">input=</span>passworddspub)</span>
<span id="cb44-15"><a href="repeated-analysis.html#cb44-15" aria-hidden="true" tabindex="-1"></a><span class="co">#system(&quot;sudo -kS apt-get clean&quot;, input=passworddspub)</span></span>
<span id="cb44-16"><a href="repeated-analysis.html#cb44-16" aria-hidden="true" tabindex="-1"></a><span class="co">#system(&quot;sudo -kS lshw -class disk&quot;, input=passworddspub)</span></span>
<span id="cb44-17"><a href="repeated-analysis.html#cb44-17" aria-hidden="true" tabindex="-1"></a><span class="co">#system(&quot;systemd-resolve --statistics&quot;)</span></span>
<span id="cb44-18"><a href="repeated-analysis.html#cb44-18" aria-hidden="true" tabindex="-1"></a><span class="co">#system(&quot;systemd-resolve --flush-caches&quot;)</span></span>
<span id="cb44-19"><a href="repeated-analysis.html#cb44-19" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.sleep</span>(<span class="dv">5</span>) <span class="co"># 5 second pause</span></span>
<span id="cb44-20"><a href="repeated-analysis.html#cb44-20" aria-hidden="true" tabindex="-1"></a><span class="fu">tic</span>()</span>
<span id="cb44-21"><a href="repeated-analysis.html#cb44-21" aria-hidden="true" tabindex="-1"></a><span class="co"># multic core 40개, 500개 병원씩 반복</span></span>
<span id="cb44-22"><a href="repeated-analysis.html#cb44-22" aria-hidden="true" tabindex="-1"></a>hop_list[[z]] <span class="ot">=</span> <span class="fu">mclapply</span>(((z<span class="dv">-1</span>)<span class="sc">*</span><span class="dv">500</span><span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">500</span><span class="sc">*</span>z), hospital_long, <span class="at">mc.cores=</span><span class="dv">40</span>)</span>
<span id="cb44-23"><a href="repeated-analysis.html#cb44-23" aria-hidden="true" tabindex="-1"></a><span class="fu">toc</span>()</span>
<span id="cb44-24"><a href="repeated-analysis.html#cb44-24" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(((z<span class="dv">-1</span>)<span class="sc">*</span><span class="dv">500</span><span class="sc">+</span><span class="dv">1</span>))</span>
<span id="cb44-25"><a href="repeated-analysis.html#cb44-25" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>((<span class="dv">500</span><span class="sc">*</span>z))</span>
<span id="cb44-26"><a href="repeated-analysis.html#cb44-26" aria-hidden="true" tabindex="-1"></a>hop_list_m[[z]] <span class="ot">=</span> <span class="fu">do.call</span>(rbind, hop_list[[z]]) <span class="sc">%&gt;%</span></span>
<span id="cb44-27"><a href="repeated-analysis.html#cb44-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">keydate =</span> datasave_foler <span class="sc">%&gt;%</span><span class="fu">as.numeric</span>())</span>
<span id="cb44-28"><a href="repeated-analysis.html#cb44-28" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(hop_list_m[[z]], <span class="fu">sprintf</span>(<span class="st">&quot;%s/%s/%s%s%s%s&quot;</span>, <span class="st">&quot;process&quot;</span>, datasave_foler,  datasave_foler, <span class="st">&quot;_&quot;</span>, <span class="dv">500</span><span class="sc">*</span>z , <span class="st">&quot;.rds&quot;</span> ))</span>
<span id="cb44-29"><a href="repeated-analysis.html#cb44-29" aria-hidden="true" tabindex="-1"></a><span class="fu">gc</span>()</span>
<span id="cb44-30"><a href="repeated-analysis.html#cb44-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb44-31"><a href="repeated-analysis.html#cb44-31" aria-hidden="true" tabindex="-1"></a><span class="fu">toc</span>()</span>
<span id="cb44-32"><a href="repeated-analysis.html#cb44-32" aria-hidden="true" tabindex="-1"></a><span class="co"># 시간 경과 확인 (월별 모든 병원 청구자료 변환 시간 40분 소요), 72개월이므로 48시간 소요 )</span></span>
<span id="cb44-33"><a href="repeated-analysis.html#cb44-33" aria-hidden="true" tabindex="-1"></a><span class="fu">tic</span>()</span>
<span id="cb44-34"><a href="repeated-analysis.html#cb44-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-35"><a href="repeated-analysis.html#cb44-35" aria-hidden="true" tabindex="-1"></a>hop_list[[<span class="dv">100</span>]] <span class="ot">=</span> <span class="fu">mclapply</span>(<span class="dv">4001</span><span class="sc">:</span><span class="fu">as.numeric</span>(hop_length), hospital_long, <span class="at">mc.cores=</span><span class="dv">40</span>)</span>
<span id="cb44-36"><a href="repeated-analysis.html#cb44-36" aria-hidden="true" tabindex="-1"></a>hop_list_m[[<span class="dv">100</span>]] <span class="ot">=</span> <span class="fu">do.call</span>(rbind, hop_list[[<span class="dv">100</span>]])<span class="sc">%&gt;%</span></span>
<span id="cb44-37"><a href="repeated-analysis.html#cb44-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">keydate =</span> datasave_foler <span class="sc">%&gt;%</span><span class="fu">as.numeric</span>())</span>
<span id="cb44-38"><a href="repeated-analysis.html#cb44-38" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(hop_list_m[[<span class="dv">100</span>]], <span class="fu">sprintf</span>(<span class="st">&quot;%s/%s/%s%s%s%s&quot;</span>, <span class="st">&quot;process&quot;</span>, datasave_foler,  datasave_foler, <span class="st">&quot;_&quot;</span>, <span class="dv">9000</span> , <span class="st">&quot;.rds&quot;</span> ))</span>
<span id="cb44-39"><a href="repeated-analysis.html#cb44-39" aria-hidden="true" tabindex="-1"></a><span class="fu">gc</span>()</span>
<span id="cb44-40"><a href="repeated-analysis.html#cb44-40" aria-hidden="true" tabindex="-1"></a><span class="fu">toc</span>()</span>
<span id="cb44-41"><a href="repeated-analysis.html#cb44-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-42"><a href="repeated-analysis.html#cb44-42" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&quot;total per 1 month&quot;</span>)</span>
<span id="cb44-43"><a href="repeated-analysis.html#cb44-43" aria-hidden="true" tabindex="-1"></a><span class="fu">toc</span>()</span></code></pre></div>
</div>
<div id="데이터-스텝-1-방법-요약" class="section level4 hasAnchor" number="17.4.2.2">
<h4><span class="header-section-number">17.4.2.2</span> 데이터 스텝 1 방법 요약<a href="repeated-analysis.html#데이터-스텝-1-방법-요약" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>R로 빅데이터 분석시 주의 점.</p>
<ul>
<li>컴퓨터 성능 확인
<ul>
<li>메모리 한계를 확인</li>
<li>용량 한계 (root 폴더)</li>
</ul></li>
<li>한 유닛당 분석 용량 확인
<ul>
<li>메모리 cpu 사용량 확인</li>
<li>시간 측정</li>
<li>하드웨어 온도 측정</li>
</ul></li>
<li>멀티 코어 vs 순차적 loop
<ul>
<li>멀티 코어와 순차적 loop 를 하이브르드해서 부담 줄이기</li>
<li>차라리 시간이 오래 걸리는 것이 좋다</li>
</ul></li>
<li>반복 작업 동안 모니터링 및 예상 분석
<ul>
<li>모니터링은 원격 서버에서</li>
<li>예상 분석도 원격 서버에서</li>
</ul></li>
</ul>

</div>
</div>
</div>
</div>



            </section>

          </div>
        </div>
      </div>
<a href="date-and-time-series.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="r-markdown.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["testbook.pdf", "testbook.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
